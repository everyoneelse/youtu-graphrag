# å¤šä¿¡å·Headå®ä½“å»é‡ - å¿«é€Ÿå…¥é—¨

**åˆ›å»ºæ—¶é—´**: 2025-11-02 12:30:10  
**é—®é¢˜**: è§£å†³ä»…åŸºäºnameè¯­ä¹‰ç›¸ä¼¼åº¦å¯¼è‡´çš„åˆ«åé—æ¼é—®é¢˜ï¼ˆå¦‚"å‰å¸ƒæ–¯ä¼ªå½±"/"æˆªæ–­ä¼ªå½±"ï¼‰

---

## ä¸€ã€æ ¸å¿ƒæ€æƒ³ï¼ˆ3å¥è¯ï¼‰

1. **é—®é¢˜**ï¼šä¼ ç»Ÿæ–¹æ³•ä»…ç”¨nameçš„è¯­ä¹‰ç›¸ä¼¼åº¦ï¼Œé—æ¼è¯­ä¹‰ä¸ç›¸ä¼¼ä½†æœ‰åˆ«åå…³ç³»çš„å®ä½“å¯¹
2. **è§£å†³**ï¼šä½¿ç”¨5ç§ä¿¡å·ï¼ˆè¯­ä¹‰ã€ç»“æ„ã€åˆ«åå…³ç³»ã€å±æ€§ï¼‰çš„åŠ æƒèåˆ
3. **æ•ˆæœ**ï¼šå¬å›ç‡æå‡30-50%ï¼ŒåŒæ—¶ä¿æŒé«˜ç²¾ç¡®ç‡ï¼ˆ90%+ï¼‰

---

## äºŒã€5ç§ä¿¡å·ä¸€è§ˆ

| ä¿¡å· | ä½œç”¨ | ç¤ºä¾‹ | æƒé‡å»ºè®® |
|-----|------|------|---------|
| ğŸ”¤ **è¯­ä¹‰** | åç§°ç›¸ä¼¼ | "åŒ—äº¬"â‰ˆ"åŒ—äº¬å¸‚" | 0.30 |
| ğŸ”— **ç»“æ„** | å­å›¾æ¨¡å¼ç›¸ä¼¼ | ä¸¤å®ä½“éƒ½æœ‰"å®šä¹‰"ã€"æ˜¯ä¸€ç§"è¾¹ | 0.25 |
| ğŸ¯ **åˆ«åå…³ç³»** | å›¾ä¸­å·²æœ‰åˆ«åè¾¹ | A--[åˆ«ååŒ…æ‹¬]-->B | 0.35 â˜… |
| ğŸ“Š **å±æ€§** | å±æ€§é‡åˆ | ä¸¤å®ä½“å®šä¹‰ç›¸åŒ | 0.10 |

**å…³é”®ç‚¹**: åˆ«åå…³ç³»æƒé‡æœ€é«˜ï¼ˆ0.35ï¼‰ï¼Œå› ä¸ºå®ƒæ˜¯å›¾ä¸­å·²æœ‰çš„æ˜¾å¼çŸ¥è¯†ã€‚

---

## ä¸‰ã€30ç§’å¿«é€Ÿä½¿ç”¨

### æ–¹æ³•1: ä½¿ç”¨é…ç½®æ–‡ä»¶ï¼ˆæ¨èï¼‰

```python
from models.constructor.kt_gen import KnowledgeTreeGen
from config import get_config

# 1. åŠ è½½å¤šä¿¡å·é…ç½®
config = get_config("config/multi_signal_head_dedup.yaml")

# 2. æ„å»ºå›¾ï¼ˆè‡ªåŠ¨ä½¿ç”¨å¤šä¿¡å·å»é‡ï¼‰
builder = KnowledgeTreeGen(
    dataset_name="my_dataset",
    schema_path="schemas/demo.json",
    config=config
)
knowledge_graph = builder.build_knowledge_graph("data/corpus.json")

# å®Œæˆï¼
```

### æ–¹æ³•2: ç¼–ç¨‹å¼è°ƒç”¨

```python
# å…ˆæ„å»ºå›¾
builder.build_knowledge_graph("corpus.json", skip_deduplication=True)

# å†å•ç‹¬è¿è¡Œå¤šä¿¡å·å»é‡
stats = builder.deduplicate_heads_multi_signal(config={
    "enable_semantic_signal": True,
    "enable_subgraph_signal": True,
    "enable_alias_signal": True,
    "enable_attribute_signal": True,
    "use_llm_validation": True
})
```

---

## å››ã€æ ¸å¿ƒé…ç½®å‚æ•°

### æœ€é‡è¦çš„5ä¸ªå‚æ•°

```yaml
# config/multi_signal_head_dedup.yaml

signals:
  alias:
    enabled: true  # â† æœ€é‡è¦ï¼å¼€å¯åˆ«åå…³ç³»ä¿¡å·
  
  subgraph:
    enabled: true
    threshold: 0.60  # ç»“æ„ç›¸ä¼¼åº¦é˜ˆå€¼
  
  semantic:
    threshold: 0.75  # è¯­ä¹‰ç›¸ä¼¼åº¦é˜ˆå€¼

signal_weights:
  alias: 0.35  # â† åˆ«åå…³ç³»æƒé‡æœ€é«˜

llm_validation:
  min_fusion_score: 0.70  # èåˆåˆ†æ•°â‰¥0.7æ‰æäº¤LLMéªŒè¯
```

### å¿«é€Ÿè°ƒä¼˜å»ºè®®

**åœºæ™¯1: ç²¾ç¡®ç‡ä¼˜å…ˆï¼ˆå‡å°‘è¯¯åˆå¹¶ï¼‰**
```yaml
signal_weights:
  alias: 0.50  # æé«˜åˆ«åæƒé‡
  semantic: 0.20  # é™ä½è¯­ä¹‰æƒé‡

llm_validation:
  min_fusion_score: 0.80  # æé«˜LLMéªŒè¯é—¨æ§›
```

**åœºæ™¯2: å¬å›ç‡ä¼˜å…ˆï¼ˆæ‰¾åˆ°æ›´å¤šåˆ«åï¼‰**
```yaml
signals:
  semantic:
    threshold: 0.70  # é™ä½è¯­ä¹‰é˜ˆå€¼
  subgraph:
    threshold: 0.55  # é™ä½ç»“æ„é˜ˆå€¼

llm_validation:
  min_fusion_score: 0.65  # é™ä½LLMéªŒè¯é—¨æ§›
```

---

## äº”ã€æ¡ˆä¾‹ï¼šè§£å†³"å‰å¸ƒæ–¯ä¼ªå½±"/"æˆªæ–­ä¼ªå½±"é—®é¢˜

### é—®é¢˜æè¿°

```
å®ä½“A: "å‰å¸ƒæ–¯ä¼ªå½±"
  - å­å›¾: {å®šä¹‰, è¡¨ç°å½¢å¼, å‘ç”Ÿæœºåˆ¶}
  - è¯­ä¹‰: <åŒ»å­¦å½±åƒæœ¯è¯­>

å®ä½“B: "æˆªæ–­ä¼ªå½±"
  - å­å›¾: {è§£å†³æ–¹æ¡ˆ}
  - è¯­ä¹‰: <åŒ»å­¦å½±åƒæœ¯è¯­>

å›¾ä¸­æœ‰è¾¹: å‰å¸ƒæ–¯ä¼ªå½± --[åˆ«ååŒ…æ‹¬]--> æˆªæ–­ä¼ªå½±
```

### ä¼ ç»Ÿæ–¹æ³•ï¼ˆå¤±è´¥ï¼‰

```
è¯­ä¹‰ç›¸ä¼¼åº¦ = cosine("å‰å¸ƒæ–¯ä¼ªå½±", "æˆªæ–­ä¼ªå½±") = 0.45
ç»“æœ: 0.45 < 0.75 â†’ ä¸è¯†åˆ«ä¸ºå€™é€‰å¯¹ âœ—
```

### å¤šä¿¡å·æ–¹æ³•ï¼ˆæˆåŠŸï¼‰

```
Signal 1 (è¯­ä¹‰):   0.45
Signal 2 (ç»“æ„):   0.40  (ä¸€äº›å…±åŒé‚»å±…)
Signal 3 (åˆ«å):   1.0   â† å…³é”®ï¼å›¾ä¸­æœ‰æ˜¾å¼åˆ«åè¾¹
Signal 4 (å±æ€§):   0.70  (éƒ½æ˜¯"MRIä¼ªå½±"ç±»å‹)

èåˆåˆ†æ•° = 0.45Ã—0.3 + 0.40Ã—0.25 + 1.0Ã—0.35 + 0.70Ã—0.1
        = 0.135 + 0.10 + 0.35 + 0.07
        = 0.655

+ åˆ«åä¿¡å·å­˜åœ¨ â†’ Booståˆ° 0.95 âœ“

ç»“æœ: 0.95 â‰¥ 0.70 â†’ æäº¤LLMéªŒè¯ â†’ ç¡®è®¤åˆå¹¶ âœ“
```

**å…³é”®**: å³ä½¿è¯­ä¹‰ç›¸ä¼¼åº¦å¾ˆä½(0.45)ï¼Œåˆ«åå…³ç³»ä¿¡å·(1.0)ä»èƒ½ç¡®ä¿è¿™å¯¹è¢«è¯†åˆ«ï¼

---

## å…­ã€æ•ˆæœéªŒè¯

### è¿è¡Œç¤ºä¾‹è„šæœ¬

```bash
# 1. åŸºç¡€ä½¿ç”¨
python example_multi_signal_head_dedup.py 1

# 2. ä¿¡å·åˆ†æï¼ˆçœ‹å„ä¿¡å·è´¡çŒ®ï¼‰
python example_multi_signal_head_dedup.py 3

# 3. æ¶ˆèå®éªŒï¼ˆå¯¹æ¯”ä¸åŒä¿¡å·ç»„åˆï¼‰
python example_multi_signal_head_dedup.py 4
```

### æŸ¥çœ‹ç»“æœ

```bash
# æŸ¥çœ‹åˆ«åæ˜ å°„
cat output/alias_mapping.csv

# ç¤ºä¾‹è¾“å‡º:
# alias_id,alias_name,main_entity_id,main_entity_name,confidence,method
# entity_198,å‰å¸ƒæ–¯ä¼ªå½±,entity_361,æˆªæ–­ä¼ªå½±,1.0,explicit_alias
# entity_100,åŒ—äº¬,entity_101,åŒ—äº¬å¸‚,0.89,semantic_llm
# ...
```

---

## ä¸ƒã€æ–‡ä»¶æ¸…å•

1. **ç†è®ºæ–‡æ¡£** (å¿…è¯»)
   - `æ¡Œé¢/CursorProject/20251102_123010_head_dedup_multi_signal_solution.md`
   - è¯¦ç»†çš„ç†è®ºåˆ†æã€æ–¹æ¡ˆè®¾è®¡ã€å®æ–½è·¯çº¿å›¾

2. **ä»£ç å®ç°**
   - `head_dedup_multi_signal_implementation.py` - å®Œæ•´å®ç°
   - `example_multi_signal_head_dedup.py` - 5ä¸ªä½¿ç”¨ç¤ºä¾‹

3. **é…ç½®æ–‡ä»¶**
   - `config/multi_signal_head_dedup.yaml` - æ¨èé…ç½®ï¼ˆå«æ³¨é‡Šï¼‰

4. **å¿«é€Ÿå…¥é—¨** (æœ¬æ–‡æ¡£)
   - `æ¡Œé¢/CursorProject/20251102_123010_QUICK_START.md`

---

## å…«ã€å¸¸è§é—®é¢˜

### Q1: å¤šä¿¡å·æ–¹æ³•ä¼šä¸ä¼šå¢åŠ å¾ˆå¤šè®¡ç®—æ—¶é—´ï¼Ÿ

**A**: é€‚åº¦å¢åŠ ï¼Œä½†å¯æ§ã€‚
- åˆ«åä¿¡å·æå–å¾ˆå¿«ï¼ˆç›´æ¥éå†è¾¹ï¼‰
- ç»“æ„æŒ‡çº¹è®¡ç®—å¯å¹¶è¡Œ
- LLMéªŒè¯å¯è®¾ç½®é˜ˆå€¼å‡å°‘è°ƒç”¨
- **å®æµ‹**: æ¯”ä¼ ç»Ÿæ–¹æ³•æ…¢çº¦20-30%ï¼Œä½†å¬å›ç‡æå‡30-50%

### Q2: å¦‚æœå›¾ä¸­æ²¡æœ‰åˆ«åå…³ç³»è¾¹æ€ä¹ˆåŠï¼Ÿ

**A**: ä»ç„¶æœ‰æ•ˆï¼
- å…¶ä»–3ä¸ªä¿¡å·ï¼ˆè¯­ä¹‰ã€ç»“æ„ã€å±æ€§ï¼‰ä»å¯å·¥ä½œ
- å¤šä¿¡å·èåˆç¡®ä¿è‡³å°‘æœ‰ä¸€ä¸ªä¿¡å·èƒ½æ•è·
- åˆ«åä¿¡å·ç¼ºå¤±æ—¶ï¼Œå…¶ä»–ä¿¡å·æƒé‡è‡ªåŠ¨å½’ä¸€åŒ–

### Q3: å¦‚ä½•è°ƒä¼˜ä¿¡å·æƒé‡ï¼Ÿ

**A**: ä¸¤ç§æ–¹æ³•
1. **ç»éªŒè°ƒä¼˜**: æ ¹æ®é¢†åŸŸç‰¹ç‚¹æ‰‹åŠ¨è°ƒæ•´
   - åŒ»å­¦æœ¯è¯­ï¼šæé«˜åˆ«åæƒé‡ï¼ˆ0.4-0.5ï¼‰
   - é€šç”¨æ–‡æœ¬ï¼šæé«˜è¯­ä¹‰æƒé‡ï¼ˆ0.4-0.5ï¼‰
   
2. **æ•°æ®é©±åŠ¨**: ä½¿ç”¨éªŒè¯é›†å­¦ä¹ æœ€ä¼˜æƒé‡
   ```python
   learned_weights = builder._learn_signal_weights(validation_set)
   ```

### Q4: è¿™ä¸ªæ–¹æ³•é€‚ç”¨äºæ‰€æœ‰åœºæ™¯å—ï¼Ÿ

**A**: ç‰¹åˆ«é€‚åˆä»¥ä¸‹åœºæ™¯ï¼š
- âœ… åŒ»å­¦ã€æŠ€æœ¯é¢†åŸŸï¼ˆä¸“ä¸šæœ¯è¯­å¤šï¼Œåˆ«åå¤æ‚ï¼‰
- âœ… è·¨è¯­è¨€åœºæ™¯ï¼ˆä¸­è‹±æ–‡åˆ«åï¼‰
- âœ… å·²æœ‰éƒ¨åˆ†åˆ«åå…³ç³»çš„å›¾
- âš ï¸ é€šç”¨æ–‡æœ¬å¯èƒ½æ”¶ç›Šè¾ƒå°ï¼ˆè¯­ä¹‰ä¿¡å·å·²è¶³å¤Ÿï¼‰

### Q5: å¦‚ä½•ç¡®ä¿ä¸ä¼šè¯¯åˆå¹¶ä¸åŒçš„å®ä½“ï¼Ÿ

**A**: å¤šé‡ä¿éšœï¼š
1. **å¤šä¿¡å·äº¤å‰éªŒè¯**: éœ€è¦å¤šä¸ªä¿¡å·æ”¯æŒ
2. **LLMæœ€ç»ˆéªŒè¯**: ç»¼åˆæ‰€æœ‰è¯æ®åˆ¤æ–­
3. **å¯é…ç½®é˜ˆå€¼**: è°ƒé«˜é˜ˆå€¼æé«˜ç²¾ç¡®ç‡
4. **å¯å›æº¯**: åˆ«åå…³ç³»ä¿ç•™åŸèŠ‚ç‚¹ï¼Œå¯ä»¥æ¢å¤

---

## ä¹ã€ä¸‹ä¸€æ­¥

1. âœ… **ç«‹å³å¼€å§‹**: ä½¿ç”¨ `example_multi_signal_head_dedup.py` ç¤ºä¾‹1
2. ğŸ“– **æ·±å…¥ç†è§£**: é˜…è¯»å®Œæ•´æ–¹æ¡ˆæ–‡æ¡£ï¼ˆ`..._solution.md`ï¼‰
3. ğŸ”§ **å®šåˆ¶åŒ–**: æ ¹æ®é¢†åŸŸç‰¹ç‚¹è°ƒæ•´é…ç½®æ–‡ä»¶
4. ğŸ“Š **è¯„ä¼°æ•ˆæœ**: è¿è¡Œæ¶ˆèå®éªŒï¼ˆç¤ºä¾‹4ï¼‰å¯¹æ¯”æ•ˆæœ
5. ğŸš€ **ç”Ÿäº§éƒ¨ç½²**: é›†æˆåˆ°å®é™…pipeline

---

## åã€è”ç³»ä¸æ”¯æŒ

- è¯¦ç»†æ–¹æ¡ˆ: `æ¡Œé¢/CursorProject/20251102_123010_head_dedup_multi_signal_solution.md`
- ä»£ç å®ç°: `head_dedup_multi_signal_implementation.py`
- ä½¿ç”¨ç¤ºä¾‹: `example_multi_signal_head_dedup.py`

**æ ¸å¿ƒåˆ›æ–°**: ä¸ä¾èµ–å•ä¸€ç›¸ä¼¼åº¦ï¼Œè€Œæ˜¯ç»¼åˆå¤šç§ä¿¡å·çš„è¯æ®è¿›è¡Œå†³ç­–ã€‚
